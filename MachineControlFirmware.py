from pymycobot.mycobot import MyCobot
from pymycobot.genre import Angle
from pymycobot.genre import Coord
import paho.mqtt.client as mqtt
import json
import time
mc = MyCobot('com6','115200')
mc.send_angles([5, 62, 125, -94, 0, -3], 50)
mc.set_gripper_state(1, 70)
MQTT_BROKER = "broker.hivemq.com"
MQTT_PORT = 1883
MQTT_TOPIC = "roblox"
messang={
    "action":3
}
messang_json=json.dumps(messang)

def on_connect(client, userdata, flags, rc):# MQTT 連接回調函數
    print(f"Connected with result code {rc}")
    client.subscribe(MQTT_TOPIC)
def on_message(client, userdata, msg):# MQTT 消息回調函數
    command_data = json.loads(msg.payload.decode())
    print(f"Received command data: {command_data}")
    action = command_data.get("action", "")
    ingredient = command_data.get("ingredient", "")  # 默认为空字符串
    count = command_data.get("count", 1)# 默认为 1
   
    print(f"Action: {action}, Ingredient: {ingredient}, Count: {count}")
    
    if "action" in command_data:
        action = command_data["action"]
        print(f"Action: {action}")
    if "count" in command_data:
        count = int(command_data["count"])  # 次數
        print(f"Count: {count}")
    if "ingredient" in command_data:
        ingredient = command_data["ingredient" ""]
        print(f"Ingredient: {ingredient}")
    if action == "coffee":
        coffee(count, ingredient)
    elif action == "blacktea":
        blacktea(count, ingredient)
    elif action == "greentea": 
        greentea(count, ingredient)
    elif action == "cocoa":
        cocoa(count, ingredient)
    elif action == "milk":
        milk(count, ingredient)
    else:
        print("Unknown action")



def coffee(count, ingredient):
    print(f"Making coffee with ingredient {ingredient}...")
    for i in range(count):
        print(f"Performing action {i+1} of {count}")
        mc.send_angles([28, 77, 55, -41, -0, -28], 40)
        time.sleep(5)
        mc.send_angles([25, 90, 28, -26, -4, -25], 40)
        time.sleep(5)
        mc.send_angles([28, 77, 55, -41, -0, -28], 40)
        time.sleep(5)
        if ingredient:
            print(f"正在添加配料：{ingredient}。")
        if ingredient.lower() == "coldweeather":
            print("添加寒天")
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 40)
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 50)
            time.sleep(3)
            mc.send_angles([25, 90, 28, -26, -4, -25], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "pearl":
            print("添加珍珠")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([3, 64, 100, -76, -2, -3], 50)
            time.sleep(3)
            mc.send_angles([4, 71, 85, -71, -3, -7], 50)
            time.sleep(3)
            mc.send_angles([3, 64, 100, -76, -2, -3], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "coconut":
            print("添加椰果")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([-24, 79, 86, -88, 0, 19], 50)
            time.sleep(3)
            mc.send_angles([-23, 76, 81, -75, -2, 19], 50)
            time.sleep(3)
            mc.send_angles([-24, 79, 86, -88, 0, 19], 50)
            time.sleep(3)
            mc.send_angles([-30, 62, 124, -101, -0, 28], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "fairygrass":
            print("添加仙草")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([-45, 81, 64, -65, 3, 42], 50)
            time.sleep(3)
            mc.send_angles([-42, 81, 56, -54, 2, 40], 50)
            time.sleep(3)
            mc.send_angles([-45, 81, 64, -65, 3, 42], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "teajelly":
            print("添加茶凍")
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 40)
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 50)
            time.sleep(3)
            mc.send_angles([25, 90, 28, -26, -4, -25], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        else:
            print(f"未找到指定的配料：{ingredient}")
            time.sleep(1)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
    
   
   
def blacktea(count, ingredient):
    print(f"Making blacktea with ingredient {ingredient}...")
    for i in range(count):
        print(f"Performing action {i+1} of {count}")
        mc.send_angles([3, 64, 100, -76, -2, -3], 40)
        time.sleep(5)
        mc.send_angles([4, 71, 85, -71, -3, -7], 40)
        time.sleep(5)
        mc.send_angles([3, 64, 100, -76., -2, -3], 40)
        time.sleep(5)
        if ingredient:
            print(f"正在添加配料：{ingredient}。")
        if ingredient.lower() == "coldweeather":
            print("添加寒天")
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 40)
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 50)
            time.sleep(3)
            mc.send_angles([25, 90, 28, -26, -4, -25], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "pearl":
            print("添加珍珠")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([3, 64, 100, -76, -2, -3], 50)
            time.sleep(3)
            mc.send_angles([4, 71, 85, -71, -3, -7], 50)
            time.sleep(3)
            mc.send_angles([3, 64, 100, -76, -2, -3], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "coconut":
            print("添加椰果")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([-24, 79, 86, -88, 0, 19], 50)
            time.sleep(3)
            mc.send_angles([-23, 76, 81, -75, -2, 19], 50)
            time.sleep(3)
            mc.send_angles([-24, 79, 86, -88, 0, 19], 50)
            time.sleep(3)
            mc.send_angles([-30, 62, 124, -101, -0, 28], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "fairygrass":
            print("添加仙草")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([-45, 81, 64, -65, 3, 42], 50)
            time.sleep(3)
            mc.send_angles([-42, 81, 56, -54, 2, 40], 50)
            time.sleep(3)
            mc.send_angles([-45, 81, 64, -65, 3, 42], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "teajelly":
            print("添加茶凍")
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 40)
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 50)
            time.sleep(3)
            mc.send_angles([25, 90, 28, -26, -4, -25], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        else:
            print(f"未找到指定的配料：{ingredient}")
            time.sleep(1)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)


def greentea(count, ingredient):
    print(f"Making greentea with ingredient {ingredient}...")
    for i in range(count):
        print(f"Performing action {i+1} of {count}")
        mc.send_angles([-24, 79, 86, -88, 0, 19], 40)
        time.sleep(5)
        mc.send_angles([-23, 76, 81, -75, -2, 19], 40)
        time.sleep(5)
        mc.send_angles([-24, 79, 86, -88, 0, 19], 40)
        time.sleep(5)
        mc.send_angles([-30, 62, 124, -101, -0, 28], 50)
        time.sleep(3)
        if ingredient:
            print(f"正在添加配料：{ingredient}。")
        if ingredient.lower() == "coldweeather":
            print("添加寒天")
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 40)
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 50)
            time.sleep(3)
            mc.send_angles([25, 90, 28, -26, -4, -25], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "pearl":
            print("添加珍珠")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([3, 64, 100, -76, -2, -3], 50)
            time.sleep(3)
            mc.send_angles([4, 71, 85, -71, -3, -7], 50)
            time.sleep(3)
            mc.send_angles([3, 64, 100, -76, -2, -3], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "coconut":
            print("添加椰果")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([-24, 79, 86, -88, 0, 19], 50)
            time.sleep(3)
            mc.send_angles([-23, 76, 81, -75, -2, 19], 50)
            time.sleep(3)
            mc.send_angles([-24, 79, 86, -88, 0, 19], 50)
            time.sleep(3)
            mc.send_angles([-30, 62, 124, -101, -0, 28], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "fairygrass":
            print("添加仙草")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([-45, 81, 64, -65, 3, 42], 50)
            time.sleep(3)
            mc.send_angles([-42, 81, 56, -54, 2, 40], 50)
            time.sleep(3)
            mc.send_angles([-45, 81, 64, -65, 3, 42], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "teajelly":
            print("添加茶凍")
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 40)
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 50)
            time.sleep(3)
            mc.send_angles([25, 90, 28, -26, -4, -25], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        else:
            print(f"未找到指定的配料：{ingredient}")
            time.sleep(1)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)


def cocoa(count, ingredient):
    print(f"Making cocoa with ingredient {ingredient}...")
    for i in range(count):
        print(f"Performing action {i+1} of {count}")
        mc.send_angles([-45, 81, 64, -65, 3, 42], 40)
        time.sleep(5)
        mc.send_angles([-42, 81, 56, -54, 2, 40], 40)
        time.sleep(5)
        mc.send_angles([-45, 81, 64, -65, 3, 42], 40)
        time.sleep(5)
        if ingredient:
            print(f"正在添加配料：{ingredient}。")
        if ingredient.lower() == "coldweeather":
            print("添加寒天")
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 40)
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 50)
            time.sleep(3)
            mc.send_angles([25, 90, 28, -26, -4, -25], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "pearl":
            print("添加珍珠")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([3, 64, 100, -76, -2, -3], 50)
            time.sleep(3)
            mc.send_angles([4, 71, 85, -71, -3, -7], 50)
            time.sleep(3)
            mc.send_angles([3, 64, 100, -76, -2, -3], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "coconut":
            print("添加椰果")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([-24, 79, 86, -88, 0, 19], 50)
            time.sleep(3)
            mc.send_angles([-23, 76, 81, -75, -2, 19], 50)
            time.sleep(3)
            mc.send_angles([-24, 79, 86, -88, 0, 19], 50)
            time.sleep(3)
            mc.send_angles([-30, 62, 124, -101, -0, 28], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "fairygrass":
            print("添加仙草")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([-45, 81, 64, -65, 3, 42], 50)
            time.sleep(3)
            mc.send_angles([-42, 81, 56, -54, 2, 40], 50)
            time.sleep(3)
            mc.send_angles([-45, 81, 64, -65, 3, 42], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "teajelly":
            print("添加茶凍")
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 40)
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 50)
            time.sleep(3)
            mc.send_angles([25, 90, 28, -26, -4, -25], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        else:
            print(f"未找到指定的配料：{ingredient}")
            time.sleep(1)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)


def milk(count, ingredient):
    print(f"Making milk with ingredient {ingredient}...")
    for i in range(count):
        print(f"Performing action {i+1} of {count}")
        mc.send_angles([28, 77, 55, -41, -0, -28], 40)
        time.sleep(5)
        mc.send_angles([25, 90, 28, -26, -4, -25], 40)
        time.sleep(5)
        mc.send_angles([28, 77, 55, -41, -0, -28], 40)
        time.sleep(5)
        if ingredient:
            print(f"正在添加配料：{ingredient}。")
        if ingredient.lower() == "coldweeather":
            print("添加寒天")
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 40)
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 50)
            time.sleep(3)
            mc.send_angles([25, 90, 28, -26, -4, -25], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "pearl":
            print("添加珍珠")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([3, 64, 100, -76, -2, -3], 50)
            time.sleep(3)
            mc.send_angles([4, 71, 85, -71, -3, -7], 50)
            time.sleep(3)
            mc.send_angles([3, 64, 100, -76, -2, -3], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "coconut":
            print("添加椰果")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([-24, 79, 86, -88, 0, 19], 50)
            time.sleep(3)
            mc.send_angles([-23, 76, 81, -75, -2, 19], 50)
            time.sleep(3)
            mc.send_angles([-24, 79, 86, -88, 0, 19], 50)
            time.sleep(3)
            mc.send_angles([-30, 62, 124, -101, -0, 28], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "fairygrass":
            print("添加仙草")
            time.sleep(2)
            mc.send_angles([5, 62, 125, -94, 0, -3], 40)
            time.sleep(2)
            mc.send_angles([-45, 81, 64, -65, 3, 42], 50)
            time.sleep(3)
            mc.send_angles([-42, 81, 56, -54, 2, 40], 50)
            time.sleep(3)
            mc.send_angles([-45, 81, 64, -65, 3, 42], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        elif ingredient.lower() == "teajelly":
            print("添加茶凍")
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 40)
            time.sleep(2)
            mc.send_angles([28, 77, 55, -41, -0, -28], 50)
            time.sleep(3)
            mc.send_angles([25, 90, 28, -26, -4, -25], 50)
            time.sleep(3)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
        
        else:
            print(f"未找到指定的配料：{ingredient}")
            time.sleep(1)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            mc.send_angles([168, 62, 125, -94, 0, -3], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 12, -11, 0, -6], 50)
            time.sleep(3)
            mc.send_angles([153, 70, 13, -10, -100, 0], 50)
            time.sleep(5)
            mc.send_angles([5, 62, 125, -94, 0, -3], 50)
            time.sleep(5)
            client.publish(MQTT_TOPIC, messang_json)
            


client = mqtt.Client()
client.on_connect = on_connect
client.on_message = on_message
client.connect(MQTT_BROKER, MQTT_PORT, 60)# 連接到 MQTT Broker
client.loop_forever()# 開始 MQTT 循環

